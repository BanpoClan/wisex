@using System.Text
@using Wisex.Entity.Models
@{
    Layout = "/Areas/Admin/Views/Shared/_Layout_Body.cshtml";
}

<script src="~/Scripts/require.js"></script>

@section Scripts{
    @Scripts.Render("~/JS/backend/echarts")
    <script>

        var grid = null;

        function reload() {
            $("#go_search").trigger("click");
        }

        $(function () {

            $.ajax({
                    type: "GET",
                    url:"@Url.Action("GetList",@ViewContext.RouteData.Values)",
                    data: { },
                    dataType: "json",
                    success: function (data) {
                        debugger;
                        var jsonData = JSON.parse(data);
                        var hits = jsonData.hits.hits;
                        var names = [];
                        var score = [];

                        var tmplData = [];

                        var len = hits.length;
                        for (var i = 0; i < len; i++) {
                            var item = hits[i];
                            var baseInfo = item._source.baseInfo;
                            names.push(item._source.baseInfo.name);
                            score.push(item._score);

                            var tmplDataItem = {};
                            tmplDataItem["name"] = item._source.baseInfo.name;
                            tmplDataItem["industry"] = item._source.baseInfo.industry;
                            tmplDataItem["background"] = item._source.baseInfo.background;
                            tmplDataItem["detail"] = [];
                            for (var j = 0; j < item._source.detailInfo.length; j++) {
                                var tmpItem = item._source.detailInfo[j];
                                tmplDataItem["detail"].push(tmpItem);
                            }

                            tmplData.push(tmplDataItem);
                        }
                        renderChart(names, score);

                        $("#data_item").tmpl(tmplData).appendTo("#detail");
                    }
            });

            function renderChart(names, score)
            {
                $("#main").html("");
                // 基于准备好的dom，初始化echarts实例
                var myChart = echarts.init(document.getElementById('main'));

                // 指定图表的配置项和数据
                var option = {
                    title: {
                        text: 'ES 搜索指标'
                    },
                    tooltip: {},
                    legend: {
                        data: ['ES 搜索指标']
                    },
                    xAxis: {
                        data: names
                    },
                    yAxis: {},
                    series: [{
                        name: '客户名称',
                        type: 'bar',
                        data: score
                    }]
                };

                // 使用刚指定的配置项和数据显示图表。
                myChart.setOption(option);
            }

        });
    </script>
}
<div class="row">
    <div class="col-lg-12">
        <div id="hidden_filter">
            @* 把需要搜索的条件放到hidden里面，在table格式化完成的时候直接调用$.html()赋值，免去了在js拼接标签的麻烦 *@
            <div class="row" style="margin-right:0;">
                <form class="form-inline" role="form">
                    <div class="form-group">
                        <label class="sr-only" for="keywords">关键字</label>
                        <input type="text" class="form-control" id="keywords" name="keywords" placeholder="" maxlength="20" value="知识产权" />
                    </div>
                    <button type="button" class="btn btn-success" name="go_search">搜索</button>
                </form>
            </div>
        </div>
        <div id="detail"></div>
        <section class="panel">
            <div id="main" style="width: 600px;height:400px;"></div>
        </section>
    </div>
</div>
<script id="data_item" type="text/x-jquery-tmpl">
    <div>
        ${name}
    </div>
    <div>
        ${industry}
    </div>
    <div>
        ${background}
    </div>
    <div>
        {{each(i,de) detail}}
        <div>${i+1}:{{= de.name}}</div>
        {{if i==0}}
        <h4>group</h4>
        {{each(j,group) groups}}
        <div>${group.name}</div>
        {{/each}}
        {{/if}}
        {{/each}}


    </div>
</script>